# BlackRoad Routing Registry
# Master table mapping orgs to services to endpoints

# ═══════════════════════════════════════════════════════════════════
# ORGANIZATION REGISTRY
# ═══════════════════════════════════════════════════════════════════

orgs:
  # ─────────────────────────────────────────────────────────────────
  # OS - Core Infrastructure (The Bridge)
  # ─────────────────────────────────────────────────────────────────
  OS:
    name: BlackRoad-OS
    code: OS
    status: active
    description: Core infrastructure, routing, coordination
    github: https://github.com/BlackRoad-OS
    primary_node: lucidia

    services:
      operator:
        description: Main routing engine
        type: internal
        endpoint: http://lucidia:8080/v1/route
        health: http://lucidia:8080/health

      metrics:
        description: KPI dashboard
        type: internal
        endpoint: http://lucidia:9090/v1/metrics
        health: http://lucidia:9090/health

      bridge:
        description: Control plane API
        type: internal
        endpoint: http://lucidia:8080/v1/bridge
        health: http://lucidia:8080/health

    repos:
      - name: .github
        description: The Bridge - central coordination
        url: https://github.com/BlackRoad-OS/.github
      - name: operator
        description: Routing engine
        url: https://github.com/BlackRoad-OS/operator
      - name: mesh
        description: Node mesh networking
        url: https://github.com/BlackRoad-OS/mesh

  # ─────────────────────────────────────────────────────────────────
  # AI - Intelligence Routing
  # ─────────────────────────────────────────────────────────────────
  AI:
    name: BlackRoad-AI
    code: AI
    status: planned
    description: AI routing, prompts, agents
    github: https://github.com/BlackRoad-AI
    primary_node: alice

    services:
      router:
        description: AI provider routing
        type: internal
        endpoint: http://alice:8080/v1/complete
        health: http://alice:8080/health
        fallback: http://lucidia:8080/v1/ai

      embeddings:
        description: Vector embeddings
        type: internal
        endpoint: http://alice:8080/v1/embed
        health: http://alice:8080/health

      agents:
        description: AI agent runtime
        type: internal
        endpoint: http://alice:8082/v1/agents
        health: http://alice:8082/health

    repos:
      - name: router
        description: AI provider routing
        url: https://github.com/BlackRoad-AI/router
      - name: prompts
        description: Prompt library
        url: https://github.com/BlackRoad-AI/prompts
      - name: agents
        description: Autonomous agents
        url: https://github.com/BlackRoad-AI/agents

  # ─────────────────────────────────────────────────────────────────
  # CLD - Edge/Cloud Computing (Enhanced)
  # ─────────────────────────────────────────────────────────────────
  CLD:
    name: BlackRoad-Cloud
    code: CLD
    status: active
    description: Edge compute, Cloudflare platform, CDN, tunnels, API gateway
    github: https://github.com/BlackRoad-Cloud
    primary_node: shellfish

    services:
      api_gateway:
        description: Primary API gateway (auth, rate limiting, routing)
        type: external
        endpoint: https://api.blackroad.ai
        health: https://api.blackroad.ai/health
        edge_endpoint: https://edge.blackroad.ai
        openapi: workers/api-gateway/openapi.yaml

      kv:
        description: Edge KV storage (5 namespaces)
        type: external
        endpoint: https://api.blackroad.ai/v1/kv
        health: https://api.blackroad.ai/health
        provider: cloudflare
        namespaces: [CACHE, SESSIONS, RATE_LIMITS, CONFIG, API_KEYS]

      d1:
        description: Edge D1 database (9 tables)
        type: external
        endpoint: https://api.blackroad.ai/v1/db
        health: https://api.blackroad.ai/health
        provider: cloudflare
        schema: workers/api-gateway/schema.sql

      r2:
        description: R2 object storage (S3-compatible)
        type: external
        endpoint: https://api.blackroad.ai/v1/storage
        health: https://api.blackroad.ai/health
        provider: cloudflare
        cdn: https://cdn.blackroad.ai

      vectorize:
        description: Vector embeddings index (semantic search)
        type: external
        endpoint: https://api.blackroad.ai/v1/vectorize
        provider: cloudflare

      ai:
        description: Workers AI (completion, embeddings, classification)
        type: external
        endpoint: https://api.blackroad.ai/v1/ai
        provider: cloudflare
        models:
          - "@cf/meta/llama-3.1-8b-instruct"
          - "@cf/baai/bge-base-en-v1.5"
          - "@cf/huggingface/distilbert-sst-2-int8"

      queues:
        description: Async message queues (webhooks, analytics, signals)
        type: internal
        provider: cloudflare
        queues: [blackroad-webhooks, blackroad-analytics, blackroad-signals, blackroad-dlq]

      websocket:
        description: Real-time WebSocket signal streaming
        type: external
        endpoint: wss://api.blackroad.ai/ws
        provider: cloudflare

      webhooks:
        description: Webhook ingestion (7 providers)
        type: external
        endpoint: https://api.blackroad.ai/v1/webhooks
        providers: [github, stripe, salesforce, slack, cloudflare, figma, google]

    tunnels:
      blackroad-primary:
        origin: lucidia
        config: tunnels/cloudflared-lucidia.yaml
        services_exposed: 15
      blackroad-storage:
        origin: aria
        config: tunnels/cloudflared-aria.yaml
        services_exposed: 7
      blackroad-agents:
        origin: alice
        config: tunnels/cloudflared-alice.yaml
        services_exposed: 7
      blackroad-compute:
        origin: octavia
        config: tunnels/cloudflared-octavia.yaml
        services_exposed: 11

    repos:
      - name: workers
        description: Cloudflare Workers
        url: https://github.com/BlackRoad-Cloud/workers
      - name: infra
        description: Infrastructure as code
        url: https://github.com/BlackRoad-Cloud/infra
      - name: tunnels
        description: Tunnel configurations
        url: https://github.com/BlackRoad-Cloud/tunnels

  # ─────────────────────────────────────────────────────────────────
  # HW - Hardware / IoT
  # ─────────────────────────────────────────────────────────────────
  HW:
    name: BlackRoad-Hardware
    code: HW
    status: planned
    description: Pi cluster, Hailo, sensors
    github: https://github.com/BlackRoad-Hardware
    primary_node: lucidia

    services:
      hailo:
        description: Hailo-8 inference
        type: internal
        endpoint: http://lucidia:5000/v1/inference
        health: http://lucidia:5000/health
        nodes: [lucidia, octavia, alice]

      sensors:
        description: Sensor data collection
        type: internal
        endpoint: http://lucidia:8085/v1/sensors
        health: http://lucidia:8085/health

      mesh:
        description: Node mesh management
        type: internal
        endpoint: http://lucidia:8086/v1/mesh
        health: http://lucidia:8086/health

    repos:
      - name: hailo
        description: Hailo-8 integration
        url: https://github.com/BlackRoad-Hardware/hailo
      - name: nodes
        description: Node configurations
        url: https://github.com/BlackRoad-Hardware/nodes

  # ─────────────────────────────────────────────────────────────────
  # LAB - Research & Development
  # ─────────────────────────────────────────────────────────────────
  LAB:
    name: BlackRoad-Labs
    code: LAB
    status: planned
    description: Experiments, prototypes, R&D
    github: https://github.com/BlackRoad-Labs
    primary_node: octavia

    services:
      experiments:
        description: Experiment runner
        type: internal
        endpoint: http://octavia:8090/v1/experiments
        health: http://octavia:8090/health

    repos:
      - name: experiments
        description: Active experiments
        url: https://github.com/BlackRoad-Labs/experiments

  # ─────────────────────────────────────────────────────────────────
  # SEC - Security
  # ─────────────────────────────────────────────────────────────────
  SEC:
    name: BlackRoad-Security
    code: SEC
    status: planned
    description: Zero trust, secrets, auth
    github: https://github.com/BlackRoad-Security
    primary_node: lucidia

    services:
      auth:
        description: Authentication service
        type: internal
        endpoint: http://lucidia:8087/v1/auth
        health: http://lucidia:8087/health

      vault:
        description: Secrets management
        type: internal
        endpoint: http://lucidia:8200/v1/secret
        health: http://lucidia:8200/health

    repos:
      - name: auth
        description: Authentication
        url: https://github.com/BlackRoad-Security/auth
      - name: vault
        description: Secrets vault
        url: https://github.com/BlackRoad-Security/vault

  # ─────────────────────────────────────────────────────────────────
  # FND - Foundation (Business)
  # ─────────────────────────────────────────────────────────────────
  FND:
    name: BlackRoad-Foundation
    code: FND
    status: planned
    description: CRM, billing, legal
    github: https://github.com/BlackRoad-Foundation
    primary_node: lucidia

    services:
      salesforce:
        description: Salesforce sync
        type: external
        endpoint: http://lucidia:8091/v1/salesforce
        health: http://lucidia:8091/health
        provider: salesforce

      stripe:
        description: Stripe billing
        type: external
        endpoint: http://lucidia:8092/v1/stripe
        health: http://lucidia:8092/health
        provider: stripe

      crm:
        description: CRM operations
        type: internal
        endpoint: http://lucidia:8091/v1/crm
        health: http://lucidia:8091/health

    repos:
      - name: salesforce-sync
        description: Salesforce integration
        url: https://github.com/BlackRoad-Foundation/salesforce-sync
      - name: stripe-billing
        description: Stripe integration
        url: https://github.com/BlackRoad-Foundation/stripe-billing

  # ─────────────────────────────────────────────────────────────────
  # MED - Media & Content
  # ─────────────────────────────────────────────────────────────────
  MED:
    name: BlackRoad-Media
    code: MED
    status: planned
    description: Content, social, marketing
    github: https://github.com/BlackRoad-Media
    primary_node: octavia

    services:
      content:
        description: Content management
        type: internal
        endpoint: http://octavia:8093/v1/content
        health: http://octavia:8093/health

      social:
        description: Social media automation
        type: external
        endpoint: http://octavia:8094/v1/social
        health: http://octavia:8094/health

    repos:
      - name: content
        description: Content pipeline
        url: https://github.com/BlackRoad-Media/content
      - name: social
        description: Social automation
        url: https://github.com/BlackRoad-Media/social

  # ─────────────────────────────────────────────────────────────────
  # INT - Interactive (Gaming/Metaverse)
  # ─────────────────────────────────────────────────────────────────
  INT:
    name: BlackRoad-Interactive
    code: INT
    status: planned
    description: Gaming, metaverse, VR/AR
    github: https://github.com/BlackRoad-Interactive
    primary_node: octavia

    services:
      game:
        description: Game server
        type: internal
        endpoint: http://octavia:8095/v1/game
        health: http://octavia:8095/health

      metaverse:
        description: Metaverse gateway
        type: external
        endpoint: https://meta.blackroad.ai
        health: https://meta.blackroad.ai/health

    repos:
      - name: unity-sdk
        description: Unity integration
        url: https://github.com/BlackRoad-Interactive/unity-sdk
      - name: metaverse
        description: Metaverse client
        url: https://github.com/BlackRoad-Interactive/metaverse

  # ─────────────────────────────────────────────────────────────────
  # EDU - Education
  # ─────────────────────────────────────────────────────────────────
  EDU:
    name: BlackRoad-Education
    code: EDU
    status: planned
    description: Learning, courses, tutorials
    github: https://github.com/BlackRoad-Education
    primary_node: aria

    services:
      courses:
        description: Course platform
        type: external
        endpoint: https://learn.blackroad.ai
        health: https://learn.blackroad.ai/health

      docs:
        description: Documentation
        type: external
        endpoint: https://docs.blackroad.ai
        health: https://docs.blackroad.ai/health

    repos:
      - name: courses
        description: Course content
        url: https://github.com/BlackRoad-Education/courses
      - name: docs
        description: Documentation
        url: https://github.com/BlackRoad-Education/docs

  # ─────────────────────────────────────────────────────────────────
  # GOV - Governance
  # ─────────────────────────────────────────────────────────────────
  GOV:
    name: BlackRoad-Gov
    code: GOV
    status: planned
    description: Governance, voting, proposals
    github: https://github.com/BlackRoad-Gov
    primary_node: lucidia

    services:
      governance:
        description: Governance platform
        type: internal
        endpoint: http://lucidia:8096/v1/governance
        health: http://lucidia:8096/health

    repos:
      - name: governance
        description: Governance system
        url: https://github.com/BlackRoad-Gov/governance

  # ─────────────────────────────────────────────────────────────────
  # ARC - Archive
  # ─────────────────────────────────────────────────────────────────
  ARC:
    name: BlackRoad-Archive
    code: ARC
    status: planned
    description: Storage, backup, preservation
    github: https://github.com/BlackRoad-Archive
    primary_node: aria

    services:
      storage:
        description: Object storage (Minio)
        type: internal
        endpoint: http://aria:9000
        health: http://aria:9000/minio/health/live

      gdrive:
        description: Google Drive sync
        type: external
        endpoint: http://aria:8097/v1/gdrive
        health: http://aria:8097/health
        provider: google

      backup:
        description: Backup service
        type: internal
        endpoint: http://aria:8098/v1/backup
        health: http://aria:8098/health

    repos:
      - name: gdrive-sync
        description: Google Drive integration
        url: https://github.com/BlackRoad-Archive/gdrive-sync
      - name: backup
        description: Backup automation
        url: https://github.com/BlackRoad-Archive/backup

  # ─────────────────────────────────────────────────────────────────
  # STU - Studio (Design)
  # ─────────────────────────────────────────────────────────────────
  STU:
    name: BlackRoad-Studio
    code: STU
    status: planned
    description: Design, Figma, Canva
    github: https://github.com/BlackRoad-Studio
    primary_node: octavia

    services:
      figma:
        description: Figma integration
        type: external
        endpoint: http://octavia:8099/v1/figma
        health: http://octavia:8099/health
        provider: figma

      assets:
        description: Asset pipeline
        type: internal
        endpoint: http://octavia:8100/v1/assets
        health: http://octavia:8100/health

    repos:
      - name: design-system
        description: Design tokens and components
        url: https://github.com/BlackRoad-Studio/design-system
      - name: assets
        description: Asset management
        url: https://github.com/BlackRoad-Studio/assets

  # ─────────────────────────────────────────────────────────────────
  # VEN - Ventures
  # ─────────────────────────────────────────────────────────────────
  VEN:
    name: BlackRoad-Ventures
    code: VEN
    status: planned
    description: Investments, portfolio, deals
    github: https://github.com/BlackRoad-Ventures
    primary_node: lucidia

    services:
      portfolio:
        description: Portfolio management
        type: internal
        endpoint: http://lucidia:8101/v1/portfolio
        health: http://lucidia:8101/health

    repos:
      - name: portfolio
        description: Portfolio tracker
        url: https://github.com/BlackRoad-Ventures/portfolio

  # ─────────────────────────────────────────────────────────────────
  # BBX - Blackbox Enterprises
  # ─────────────────────────────────────────────────────────────────
  BBX:
    name: Blackbox-Enterprises
    code: BBX
    status: planned
    description: Enterprise, stealth, special projects
    github: https://github.com/Blackbox-Enterprises
    primary_node: lucidia

    services:
      enterprise:
        description: Enterprise API
        type: internal
        endpoint: http://lucidia:8102/v1/enterprise
        health: http://lucidia:8102/health
        auth: required

    repos:
      - name: enterprise
        description: Enterprise platform
        url: https://github.com/Blackbox-Enterprises/enterprise


# ═══════════════════════════════════════════════════════════════════
# DEFAULT ROUTES
# ═══════════════════════════════════════════════════════════════════

defaults:
  # Fallback org when classification fails
  fallback_org: AI

  # Default service within each org
  default_services:
    OS: operator
    AI: router
    CLD: worker
    HW: hailo
    LAB: experiments
    SEC: auth
    FND: crm
    MED: content
    INT: game
    EDU: courses
    GOV: governance
    ARC: storage
    STU: assets
    VEN: portfolio
    BBX: enterprise


# ═══════════════════════════════════════════════════════════════════
# ROUTING RULES
# ═══════════════════════════════════════════════════════════════════

rules:
  # High-priority exact matches
  - pattern: "salesforce"
    org: FND
    service: salesforce
    priority: 100

  - pattern: "stripe|billing|payment"
    org: FND
    service: stripe
    priority: 100

  - pattern: "cloudflare|worker|edge"
    org: CLD
    service: worker
    priority: 100

  - pattern: "hailo|inference|26 tops"
    org: HW
    service: hailo
    priority: 100

  - pattern: "figma|canva|design"
    org: STU
    service: figma
    priority: 100

  - pattern: "gdrive|google drive|docs"
    org: ARC
    service: gdrive
    priority: 100

  # AI routing (catch-all for intelligence)
  - pattern: "ask|question|what|how|why|explain"
    org: AI
    service: router
    priority: 50

  # Code/development
  - pattern: "code|function|class|bug|debug"
    org: AI
    service: router
    priority: 50

  # Edge API routing
  - pattern: "api|gateway|endpoint|rest"
    org: CLD
    service: api_gateway
    priority: 80

  - pattern: "tunnel|mesh|node|health"
    org: CLD
    service: api_gateway
    priority: 80

  - pattern: "webhook|event|hook"
    org: CLD
    service: webhooks
    priority: 90

  - pattern: "vector|embedding|semantic|search"
    org: CLD
    service: vectorize
    priority: 80

  - pattern: "websocket|realtime|stream|ws"
    org: CLD
    service: websocket
    priority: 90

  - pattern: "cache|kv|session"
    org: CLD
    service: kv
    priority: 80

  - pattern: "storage|upload|download|file|asset"
    org: CLD
    service: r2
    priority: 70

  - pattern: "database|query|sql|table"
    org: CLD
    service: d1
    priority: 70

  # Security routing
  - pattern: "auth|login|token|jwt|secret|vault"
    org: SEC
    service: auth
    priority: 90

  # Backup and archive
  - pattern: "backup|archive|restore|snapshot"
    org: ARC
    service: backup
    priority: 80

  # Game and metaverse
  - pattern: "game|play|metaverse|vr|ar|unity"
    org: INT
    service: game
    priority: 80

  # Education
  - pattern: "learn|course|tutorial|documentation"
    org: EDU
    service: courses
    priority: 70

  # Governance
  - pattern: "governance|proposal|vote|dao"
    org: GOV
    service: governance
    priority: 80


# ═══════════════════════════════════════════════════════════════════
# EDGE API ENDPOINTS (Unified)
# All external traffic flows through the API Gateway Worker
# ═══════════════════════════════════════════════════════════════════

edge_api:
  base_url: https://api.blackroad.ai
  openapi: workers/api-gateway/openapi.yaml
  version: v1

  endpoints:
    # Public (no auth)
    - path: /health
      method: GET
      auth: none
      description: Edge health check

    - path: /v1/status
      method: GET
      auth: none
      description: Full system status

    - path: /v1/auth/login
      method: POST
      auth: none
      description: Login with email/password

    - path: /v1/auth/register
      method: POST
      auth: none
      description: Register new user

    - path: /v1/auth/refresh
      method: POST
      auth: none
      description: Refresh JWT token

    # Webhooks (signature-verified)
    - path: /v1/webhooks/{source}
      method: POST
      auth: signature
      sources: [github, stripe, salesforce, slack, cloudflare, figma, google]

    # AI (authenticated)
    - path: /v1/ai/complete
      method: POST
      auth: required
      tunnel: blackroad-agents → alice:8080

    - path: /v1/ai/embed
      method: POST
      auth: required
      tunnel: blackroad-agents → alice:8080

    - path: /v1/ai/classify
      method: POST
      auth: required
      edge: Workers AI

    - path: /v1/ai/agents
      method: [GET, POST]
      auth: required
      tunnel: blackroad-agents → alice:8082

    # Routing & Signals
    - path: /v1/route
      method: POST
      auth: required
      tunnel: blackroad-primary → lucidia:8080

    - path: /v1/signals
      method: [GET, POST]
      auth: required
      edge: D1 + Queue

    - path: /v1/metrics
      method: GET
      auth: required
      tunnel: blackroad-primary → lucidia:9090

    # Edge Data
    - path: /v1/kv/{key}
      method: [GET, PUT, DELETE]
      auth: required
      edge: KV

    - path: /v1/db/{table}
      method: [GET, POST]
      auth: required
      edge: D1

    - path: /v1/storage/{key}
      method: [GET, PUT, DELETE, HEAD]
      auth: required
      edge: R2

    - path: /v1/vectorize
      method: POST
      auth: required
      edge: Vectorize

    # WebSocket
    - path: /ws
      method: GET (upgrade)
      auth: none
      edge: Durable Object (WebSocketRoom)

    # Org Proxies
    - path: /v1/hw/*
      auth: required
      tunnel: blackroad-primary → lucidia
    - path: /v1/sec/*
      auth: required
      tunnel: blackroad-primary → lucidia
    - path: /v1/fnd/*
      auth: required
      tunnel: blackroad-primary → lucidia
    - path: /v1/gov/*
      auth: required
      tunnel: blackroad-primary → lucidia
    - path: /v1/ven/*
      auth: required
      tunnel: blackroad-primary → lucidia
    - path: /v1/bbx/*
      auth: required
      tunnel: blackroad-primary → lucidia
    - path: /v1/med/*
      auth: required
      tunnel: blackroad-compute → octavia
    - path: /v1/int/*
      auth: required
      tunnel: blackroad-compute → octavia
    - path: /v1/stu/*
      auth: required
      tunnel: blackroad-compute → octavia
    - path: /v1/lab/*
      auth: required
      tunnel: blackroad-compute → octavia
    - path: /v1/edu/*
      auth: required
      tunnel: blackroad-storage → aria
    - path: /v1/arc/*
      auth: required
      tunnel: blackroad-storage → aria


# ═══════════════════════════════════════════════════════════════════
# TUNNEL TOPOLOGY
# ═══════════════════════════════════════════════════════════════════

tunnels:
  mesh_config: tunnels/mesh-topology.yaml

  active_tunnels:
    - name: blackroad-primary
      node: lucidia
      config: tunnels/cloudflared-lucidia.yaml
      domains: [api.blackroad.ai, metrics.blackroad.ai, auth.blackroad.ai, vault.blackroad.ai, inference.blackroad.ai, gov.blackroad.ai, ssh.blackroad.ai, prometheus.blackroad.ai]

    - name: blackroad-storage
      node: aria
      config: tunnels/cloudflared-aria.yaml
      domains: [storage.blackroad.ai, storage-console.blackroad.ai, gdrive.blackroad.ai, backup.blackroad.ai, db.blackroad.ai, redis.blackroad.ai]

    - name: blackroad-agents
      node: alice
      config: tunnels/cloudflared-alice.yaml
      domains: [agents.blackroad.ai, ai.blackroad.ai, mcp.blackroad.ai, hailo-alice.blackroad.ai]

    - name: blackroad-compute
      node: octavia
      config: tunnels/cloudflared-octavia.yaml
      domains: [jobs.blackroad.ai, content.blackroad.ai, social.blackroad.ai, game.blackroad.ai, meta.blackroad.ai, figma.blackroad.ai, assets.blackroad.ai, lab.blackroad.ai]
